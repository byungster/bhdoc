# 4. Tree 저작도구 (2017.06 ~ 2018.12)


## 개요
#### 1. 시작 배경
내가 맡은 프로젝트의 규모가 크지 않다는 느낌을 받은 적이 있습니다.
게시판 유지보수, 게시글 유지보수, 데이터 보정 등 한정된 유형의 프로젝트이거나 
서비스 릴리즈 경험이나 긴급한 버그의 해결, 메인 개발자의 리소스를 좀먹는 이슈들을 주로 담당했던 것 같습니다.

그 즈음에 볼륨이나 결제 금액이 큰 규모의 고객으로부터 서비스 개선의 요구가 들어오게 되었습니다.

이를 마땅히 수행할 리소스가 없어서 넉넉한 역량이 없음에도 불구하고 제가 투입되었는데,
여태 껏 경험해보지 못한 UI에 대한 개선 이슈였습니다.
"Auto-campaign"이라는 이름의 Tree 저작도구를 처음 시작하게된 계기였습니다.
처음엔 이것이 Tree 구조인지도 정확하게 인지하지 못했습니다. 대략 5페이지 분량의 인수인계 문서에서 소개하는 내용에서 언급할 뿐이었죠.


#### 2. 가장 힘들었던 일

1. Model 개선 : 이진 트리 Model 을 일반 트리로 바꾸기
2. View 개선 : UI로 렌더링할때 Grid 형태의 배열에서 노드와 연결 선의 중첩현상, z-index 등 CSS 깨지지 않도록 수정하기
3. Controller 개선 : 계층관계 관련 SELECT 쿼리 문에서, 0번째 1번째 요소 이외에 12번째 요소까지 탐색하는 못하는 쿼리 수정하기  

IDE의 도움을 받아 전체검색을 통해 문자열부터 수정해보며 구성하고 있는 코드를 분석하며 알게된 사실은, 
UI의 데이터 모델이 되는 Tree는 Tree인데, "이진 트리"였다는 점입니다.
부모 노드는 3개 이상의 자식노드를 가질 수 있다는 가정을 하지 않고 만들어진 것이죠.
무자비한 요구사항은 아는지 모르는지 3개 이상 12개 이하의 자식 노드를 가질 수 있도록 개선해야만 했습니다.
팀내에서 도움을 받아야만 했지만, 직장 선임들은 'Auto-campaign 기능이 존재한다'는 사실만 알고 있었습니다.
담당자는 이미 퇴사한 뒤였습니다.

혈혈단신으로 로컬환경에서 해당 UI를 대상으로 키보드의 F12 키를 눌러 개발자도구를 열고, Element 지시자와 코드 편집기를 셀 수 없이 번갈아가며
부셔보고 롤백하기를 반복했습니다. 온통 빨간색으로 물들었던 개발자 도구 콘솔이 점점 제 색깔을 찾아갈 무렵이 되자
머릿 속에는 딱 개발이 가능한 수준까지만 설계를 파악하고 코드를 야금야금 수정해나갔던 기억이 생생합니다.
관련된 기획을 모두 착실히 반영했다고 말할 수 있을 때 부터, QA 테스트를 시작하게 되었고,
기획서에 제시되어 있지는 않지만 영향범위에 해당하는 부분들에서의 버그, 이른바 사이드 이펙트가 발견되기 시작했고,
혼자서 겪은 시행착오를 통해 습득한 지식보다 QA 팀과 티키타카를 통하여 습득한 지식이 더 많아질 때쯤 
QA 테스트의 버그 리포트 속도는 점점 줄어들기 시작했고, 게임에서 전직 테스트를 겪은 것처럼 힘들면서도 뿌듯했던 기억이 납니다.

## 본론

#### 사용 예시

UI는 사용자와 상호작용을 통해 부모노드부터 자식노드까지 하나의 Tree를 완성할 수 있고
최상위 부모노드는 "시작" Flow가 되며, 유저가 가장 마지막에 만든 타일이 "End"일 경우 사용자는 더 이상의 자식노드를 생성하지 못합니다.
뿐만아니라, 부모노드가 완성되어야만 타입이 자식을 하나만 놓을 수 있는지, 둘을 놓을 수 있는지, 셋 이상을 놓을 수 있는지 결정합니다.
부모노드가 완성되지 않았다면, 만들 수 있는 노드도 알지 못합니다.

#### 개발한 기능 1. Survey

부모노드가 "Survey"라는 타입이면, 자식 노드는 1번부터 12번까지 다양한 선택지로 분기할 수 있는 기능입니다.

#### 개발한 기능 2. Go To

부모노드가 "Go To"라는 타입이면, 자식 노드가 조건에 따라 다르게 붙으면서도, 이웃하지 않는 자식 노드에게로 흐를 수 있는 기능입니다.

#### 개발한 기능 3. Lead Scoring, Site Event Tracking

#### 개발한 기능 4. Template 추천 기능


#### 트리 컴포넌트
Tree 컴포넌트를 기반으로 제작되어 있는 Flowchart 제작도구를 개선하였습니다.
 일반 트리에 가상의 연결리스트를 추가하였습니다.

##### 이진트리

Survey 기능 추가를 위해 이진트리를 일반 트리로 바꾼다.

##### 이진트리와 일반트리의 차이점

![출처: https://medium.com/quantum-ant/%ED%8A%B8%EB%A6%AC-tree-cec69cfddb14](https://imgur.com/JUZULwK.png)

